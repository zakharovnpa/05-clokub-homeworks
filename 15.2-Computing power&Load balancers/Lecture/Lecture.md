### Лекция по теме "15.2"

Вычислительные мощности
Балансировщики нагрузки
в Cloud Provider
Денис
АльмухаметовДенис Альмухаметов
System Architect
Netcracker
2План занятия
1. Вычислительные мощности
2. Хранение
3. Балансировщики нагрузки
4. Итоги
5. Домашнее задание
3Вычислительные мощности
(виртуальные машины)
4AWS EC2 — Elastic Compute Cloud (ECC)
AWS EC2 бывают:
● On Demand — объем вычислительных ресурсов оплачивается на
почасовой или посекундной основе, в зависимости от
используемых инстансов.
● Saving Plans — объем, предусматривающий снижение оплаты при
условии, что клиент обязуется использовать этот постоянный
объем в течение 1 или 3 лет.
● Spot — объем свободных вычислительных ресурсов Amazon EC2,
со скидкой до 90 % по сравнению с ценой по требованию
● Dedicated — выделенный объем физических серверов,
предоставляемый только одному клиенту
5Типы EC2 — инстансов
Типы инстансов включают различные комбинации таких
компонентов, как: ЦПУ, память, хранилище и сетевые
возможности, что позволяет выбрать соответствующий набор
ресурсов для приложений.
Каждый тип инстанса включает один или несколько размеров
инстансов, что позволяет масштабировать ресурсы в соответствии
с требованиями целевой рабочей нагрузки.
6Типы EC2 — инстансов
● General Purpose
● Compute Optimised
● Memory Optimised
● Accelerated Computing
● Storage Optimised
Источник
Типы инстансов Amazon EC2 – Amazon Web Services
7Сетевые адаптеры для ЕС2
● ENI — (Elastic network interfaces) виртуальная сетевая карта
инстанса.
● Enhanced network высокоскоростная сетевая карта 10Гбит/с,
100Гбит/с.
● Elastic Fabric Adapter используется для HPC и ML, где высокие
требования к задержкам.
8YC Compute Cloud
● Виртуальная машина — объем вычислительных ресурсов
оплачивается посекундно. Цены указаны за 1 час использования.
● Прерываемая виртуальная машина — виртуальные машины,
которые могут быть принудительно остановлены в любой момент.
Это может произойти в двух случаях:
○ с момента запуска виртуальной машины прошло 24 часа,
○ нехватка ресурсов для запуска обычной виртуальной
машины в той же зоне доступности. Вероятность такого
события низкая, но может меняться изо дня в день.
9YC - Платформы Compute Cloud
Процессор Макс. кол-во
ядер (vCPU)
на ВМ Макс. кол-во GPU
( vGPU*)
Intel Broadwell Intel® Xeon® Processor
E5-2660 v4 32 -
Intel Cascade Lake Intel Xeon Gold 6230 80 -
Intel Ice Lake Intel Xeon Gold 6338 96 -
Intel Broadwell with
NVIDIA® Tesla® V100 Intel Xeon
Processor E5-2660 v4
NVIDIA® Tesla® V100 32 4 (1:8)
Intel Cascade Lake
with NVIDIA® Tesla® V100 Intel Xeon Gold 6230
NVIDIA® Tesla® V100 64 8 (1:8)
AMD EPYC™ with
NVIDIA® Ampere® A100 AMD EPYC™ 7702
NVIDIA® Ampere® A100 224 8 (1:28)
Intel Broadwell with
NVIDIA® vGPU Tesla®
V100 8G Intel Xeon
Processor E5-2660 v4
NVIDIA® Tesla® V100 32 8 (1:4) *
Платформа
10YC пример цен
Вычислительные
ресурсы ВМ
Вычислительные ресурсы
прерываемых ВМ
Intel Broadwell, 5%vCPU 0,1932 ₽ 0,1198 ₽
Intel Broadwell, 20%vCPU 0,5500 ₽ 0,1706 ₽
Intel Broadwell, 100%vCPU 0,7017 ₽ 0,2160 ₽
Intel Cascade Lake, 5%vCPU 0,1020 ₽ 0,0636 ₽
Intel Cascade Lake, 20%vCPU 0,3060 ₽ 0,1000 ₽
Intel Cascade Lake, 50%vCPU 0,4488 ₽ 0,1400 ₽
Intel Cascade Lake, 100%vCPU 0,7476 ₽ 0,2040 ₽
Правила тарификации для Compute Cloud | Yandex.Cloud - Документация
11YC уровни производительности vCPU
Этот уровень определяет долю вычислительного времени
физических ядер, которую гарантирует vCPU.
● При уровне производительности 5% ВМ будет иметь доступ к
физическим ядрам как минимум 5% времени — 50 миллисекунд
в течение каждой секунды. Тактовая частота процессора в это
время не ограничивается и соответствует выбранной платформе,
например, 2 ГГц для платформы Intel Ice Lake (standard-v3).
ВМ с уровнем производительности меньше 100% предназначены для
запуска приложений, не требующих высокой производительности и
не чувствительных к задержкам. Такие машины обойдутся дешевле.
12YC уровни производительности vCPU
● Виртуальные машины с уровнем производительности 100%
имеют непрерывный доступ (100% времени) к вычислительной
мощности физических ядер.
Такие ВМ предназначены для запуска приложений, требующих
высокой производительности на протяжении всего времени
работы.
Уровни производительности vCPU | Yandex.Cloud - Документация
13Хранение
14AWS - Типы Storage
● EBS — (Elastic Block Storage) — сервис блочного хранилища,
созданный для использования с EC2.
● EFS — (Elastic File Storage) сервис файлового хранилища,
который позволяет совместно использовать файловые данные
без необходимости его обслуживания.
● S3 — (Simple Storage Service) сервис хранения объектов (имеют
ключ, значение, версия, метаданные, ACL). С помощью API
обеспечивает доступ к данным через Интернет
15Типы EBS
SSD
HDD
Наименование General Purpose Provisioned IOPS Throughput
Optimized Cold
API Name (gp2, gp3) (io1, io2) (st1) (sc1)
Примеры
использования Часто
используемые База данных Big Data, DWH Файловые
серверы
Емкость 1 GB — 16 TB 4 GB — 16 TB 125 GB – 16 TB 125 GB – 16 TB
Max
IOPS*/Volume 16 000 64 000 500 250
Цена в месяц $0.08-0.1 /GB $0.125 /GB $0.045 /GB $0.015/GB
* — io1/io2/gp2/gp3 based on 16K I/O size, st1/sc1 based on 1 MB I/O size
https://aws.amazon.com/ru/ebs/volume-types/
16EBS Snapshots
Моментальный снимок EBS,
содержащий копии файлов и каталогов
файловой системы на определенный
момент времени:
● Snapshot хранить в S3,
● Snapshot инкрементальный,
● Поддержка шифрования,
● Для создания рекомендуется
остановить ЕС2 (консистентность),
● Используется для переноса ЕС2 из
одного AZ / региона в другой с
помощью AMI.
17EFS
EFS предоставляет четыре класса хранилищ:
● EFS Standard — данные хранятся с избыточностью в разных AZ;
● EFS Standard-IA (Infrequent Access) — нечастый доступ EFS
Standard;
● EFS One Zone — данные хранятся с избыточностью в одной AZ;
● EFS One Zone-IA — нечастый доступ EFS One Zone.
EFS поддерживает протокол NFSv4.
Не требуется расширять пространство. Оплата по факту
использования.
Поддерживает множество одновременных подключений.
EFS не поддерживает Windows instances.
18S3
Данные хранятся как объекты в ресурсах, которые называют
корзинами (bucket), при этом размер одного объекта может
составлять до 5 ТБ.
Доступ к объектам можно получить через точки доступа S3 или
непосредственно через имя узла контейнера.
19S3
Хранилище S3 позволяет:
● добавлять теги метаданных в объекты,
● перемещать и сохранять данные в классах хранилища S3,
● настраивать и применять элементы управления доступом к
данным
● применять аналитику больших данных
● отслеживать данные на уровне объекта и корзины
● просматривать статистику использования хранилищ и
тенденции активности в своей организации.
20S3 типы доступа
● Virtual-hosted–style access
https://bucket-name.s3.Region.amazonaws.com/file_name
например:
https://netology-devops15.s3.us-west-2.amazonaws.com/cat.png
● Path-style access
https://s3.Region.amazonaws.com/bucket-name/file_name
например:
https://s3.us-west-2.amazonaws.com/netology-devops15/cat.png
21Классы хранилищ S3
S3 предоставляет несколько классов хранилищ:
● S3 Standard — данные хранятся с избыточностью в разных AZ,
● S3 Standard-IA — нечастый доступ S3 Standard,
● S3 One Zone-IA — нечастый доступ S3 Standart в одной AZ,
● S3 Intelligent-Tiering — автоматическая оптимизация затрат
путем переноса на разные классы хранилищ S3
● S3 Glacier — экономичный класс для архивации данных
● S3 Glacier Deep Archive — класс долгосрочного хранения и
цифровой архивации данных, доступ запрашивается один‑два
раза в год
22Классы хранилищ S3
S3 Standard
S3 Intelligent-
Tiering
S3 Standard
– IA
S3 One Zone-IA
S3 Glacier
S3 Glacier
Deep Archive
Спроектировано для
доступности 99,99 % 99,9 % 99,9 % 99,5 % 99,99 % 99,99 %
Доступность согласно
SLA 99,9 % 99 % 99 % 99 % 99,9 % 99,9 %
Зоны доступности ≥3 ≥ 3 ≥ 3 1 ≥ 3 ≥3
Минимальный
оплачиваемый объем
объекта н/д н/д 128 КБ 128 КБ 40 КБ 40 КБ
Минимальный
оплачиваемый срок
хранения н/д 30 дней 30 дней 30 дней 90 дней 180 дней
Плата за извлечение
данных н/д н/д за гигабайт
извл. данных за гигабайт
извл. данных за гигабайт
извл. данных за гигабайт
извл. данных
мсек мсек мсек мсек мин или часы
(по выбору) выбрать часы
Задержка первого
байта
https://aws.amazon.com/ru/s3/storage-classes/
23YC - Типы Storage
● Диск — сервис блочного хранилища, созданный для
использования с Compute Cloud.
● Файловое хранилище — сервис файлового хранилища, который
позволяет совместно использовать файловые данные без
необходимости его обслуживания. Находится на стадии preview.
● Object Storage — сервис хранения объектов, с помощью API
обеспечивает доступ к данным через Интернет, т. е. из любой
точки. Совместим с API S3 и поэтому можно использовать
инструменты, созданные для работы с объектными хранилищами.
24Типы Дисков YC
● Сетевой SSD-диск — быстрый сетевой диск, сетевое блочное
хранилище на SSD-накопителе
● Сетевой HDD-диск — стандартный сетевой диск, сетевое блочное
хранилище на HDD-накопителе
● Нереплицируемый SSD-диск — сетевой диск с повышенной
производительностью, реализованной за счет некоторых
ограничений:
○
○
○
○
○
размер нереплицируемого диска должен быть кратен 93 ГБ,
во всех расчетах 1 ГБ = 2^30 байт,
нереплицируемые диски не могут быть загрузочными.
хранимая информация может быть временно недоступна или
утеряна в случае сбоя, поскольку в нереплицируемых дисках
отсутствует избыточность,
из нереплицируемого диска нельзя создать снимки и образы.
25Репликация Дисков и Снимки
● Каждый диск доступен и реплицируется внутри определенной
зоны доступности.
● Можно создавать резервные копии дисков в виде снимков.
Снимки реплицируются во всех зонах доступности. Можно
использовать, чтобы переносить диски между зонами
доступности.
● Несколько нереплицируемых дисков могут быть собраны в
группу размещения - группу нереплицируемых дисков, в которой
диски располагаются в разных стойках в пределах одной зоны
доступности.
● Группы размещения используются для организации избыточности
хранения данных на уровне приложения
26YC Object Storage
● Имена бакетов уникальны для всего Object Storage
● Длина имени должна быть от 3 до 63 символов
● Имя может содержать строчные буквы латинского алфавита,
цифры, дефисы и точки
27Object Storage типы доступа
● Virtual-hosted–style access
https://bucket.storage.yandexcloud.net
например:
https://netology-test.storage.yandexcloud.net/cat.jpg
● Path-style access
https://storage.yandexcloud.net/bucket/file_name
например:
https://storage.yandexcloud.net/netology-test/cat.jpg
28Классы хранилищ Object Storage
Object Storage предоставляет 2 класса хранилищ:
● стандартное — мало данных, частые запросы,
● холодное — много данных, редкие запросы.
29S3 совместимость Object Storage
API Yandex Object Storage совместим с S3 API AWS.
S3-совместимость позволяет использовать в Yandex.Cloud
популярные инструменты для работы с S3-протоколом: консольные
клиенты S3cmd и AWS CLI, файловые браузеры Cyberduck и
WinSCP, библиотеки (SDK) для Python и Java.
30Балансировщики нагрузки
31AWS ELB — балансировщик нагрузки
Elastic Load Balancer автоматически распределяет входящий
трафик приложений по нескольким целевым объектам таким, как
EC2 инстансы, контейнеры, IP‑адреса, функции Lambda и
виртуальные устройства.
Он может распределять трафик приложения с меняющейся
нагрузкой в одной зоне доступности или между несколькими
зонами доступности.
32Типы балансировщиков ELB
Application Load
Balancer
Network Load
Balancer
Gateway Load
Balancer
Уровень Layer 7 Layer 4 Layer 3, 4
Тип цели IP, инстанс,
Lambda IP, инстанс IP, инстанс
Проверки
работоспособно
сти HTTP, HTTPS,
gRPC TCP, HTTP,
HTTPS TCP, HTTP,
HTTPS
Classic Load
Balancer
Layer 4/7
TCP, SSL / TLS,
HTTP, HTTPS
33Auto Scaling Groups
Автоматический запуск новых инстансов
Amazon EC2 при повышении спроса и
автоматическое отключение ненужных
инстансов Amazon EC2 для экономии
средств, когда спрос снижается.
Состоит из 3 компонентов:
● Groups — логическая группа ЕС2-инстансов одной
функциональности;
● Conﬁguration templates — шаблон конфигурации, применяемый
на членов группы (instance type, keypair, SG, AMI ID и т.д.);
● Scaling options — политики расширения и сжатия.
https://aws.amazon.com/ru/ec2/autoscaling/
34Scaling Options of Auto Scaling Groups
● Maintain current instances — определение кол-ва ЕС2-инстансов
для текущей работы в обычном режиме. Определение
health-check.
● Ручное масштабирование — определение кол-ва min и max ЕС2-
инстансов.
● Масштабирование по расписанию.
● Масштабирование по требованию — определение параметров,
при которых будет произведено расширение ресурсов.
35Типы балансировщиков YC
Application Load Balancer
Network Load Balancer
Уровень Layer 7 Layer 4
Тип цели IP, instance instance
Проверки
работоспособности HTTP, HTTPS TCP, HTTP
36Типы масштабирования YC
● Ручное масштабирование — определение фиксированного кол-
ва ВМ.
● Автоматическое масштабирование — среднее значение метрики
не сильно отклонялось от целевого
○ Региональная
○ Зональная
Автоматически масштабируемая группа ВМ Yandex.Cloud
37Итоги
38Итоги
Сегодня мы изучили:
1. Что такое EC2-инстансы и их типы.
2. Как организовано хранение, какие виды storage бывают, чем
отличаются.
3. Что такое Route53, какие виды маршрутизации
поддерживаются.
4. Балансировщики нагрузки. Какие бывают, что умеют. Как
настраивать группы масштабирования.
39Домашнее задание
40Домашнее задание
Давайте посмотрим ваше домашнее задание.
● Вопросы по домашней работе задавайте в чате мессенджера
Slack.
● Задачи можно сдавать по частям.
● Зачёт по домашней работе проставляется после того, как
приняты все задачи.
41Задавайте вопросы и
пишите отзыв о лекции!
Денис Альмухаметов
